<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fan Control</title>
</head>
<body>
    <h1>Fan Control</h1>
    <form id="fanForm">
        <label>
            <input type="radio" name="fan" value="on"> Turn On Fan
        </label>
        <label>
            <input type="radio" name="fan" value="off"> Turn Off Fan
        </label>
        <button type="submit">Submit</button>
    </form>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.2.0/mqttws31.min.js"></script>
    <script>
        var client = new Paho.MQTT.Client('mqtt-io.adafruit.com', 443, 'web_mqtt_client');
        client.onConnectionLost = onConnectionLost;
        client.connect({
            useSSL: true,
            userName: 'your_username',
            password: 'your_mqtt_api_key',
            onSuccess: onConnect,
            onFailure: onFailure
        });

        function onConnect() {
            console.log('Connected to Adafruit IO');
        }

        function onFailure(errorMessage) {
            console.log('Failed to connect: ' + errorMessage.errorMessage);
        }

        function onConnectionLost(responseObject) {
            if (responseObject.errorCode !== 0) {
                console.log('Connection lost: ' + responseObject.errorMessage);
            }
        }

        document.getElementById('fanForm').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent form submission
            var formData = new FormData(this);
            var fanStatus = formData.get('fan');
            publishToAdafruitIO(fanStatus);
        });

        function publishToAdafruitIO(status) {
            var topic = 'your_username/feeds/fan-control'; // Replace with your feed name
            var message = new Paho.MQTT.Message(status);
            message.destinationName = topic;
            client.send(message);
            console.log('Published message: ' + status);
        }
    </script>
</body>
</html>
